# Spatio-Temporal Interpolation Model Configuration

# Experiment tag (used in output directory name)
tag: integrated

# Data paths
data_file: data/2a/2a_8.csv  # Full data file

# Model architecture
k_spatial_centers: [25, 81, 121]  # Spatial basis centers (for uniform: must be perfect squares; for gmm: n_components)
k_temporal_centers: [10, 15, 45]  # Temporal basis centers (Gaussian RBF)
spatial_basis_function: wendland      # Spatial basis function: 'wendland', 'gaussian', or 'triangular'
spatial_init_method: gmm              # Spatial basis initialization: 'uniform' (grid) or 'gmm' (data-adaptive)
spatial_learnable: true               # Whether spatial basis centers are learnable

# Gradient-based movement control (alternative to movement_penalty)
gradient_damping: true                # Enable distance-based gradient damping (reduces LR for far-moved bases)
damping_threshold: 0.0                # Distance threshold before damping starts (0.0 = 0% of domain)
damping_strength: 5.0                 # Strength of damping: higher = stronger suppression of far movements

# Traditional penalty-based movement control (not recommended with gradient_damping)
domain_penalty_weight: 0.01            # Penalty weight for centers outside [0,1]^2 (0=no penalty, 0.01-1.0 recommended)
movement_penalty_weight: 0.0          # Penalty weight for centers moving from initial positions (set to 0 when using gradient_damping)

# Sparsity penalty settings
sparsity_penalty_type: sparse_group   # Sparsity penalty type: 'none', 'element', 'group', or 'sparse_group'
sparsity_lambda_l1: 0.0           # Element-wise L1 penalty weight (for 'element' or 'sparse_group') - creates exact zeros!
sparsity_lambda_group: 0.0        # Group Lasso penalty weight (for 'group' or 'sparse_group') - encourages group sparsity
sparsity_apply_to_spatial: true       # Apply sparsity penalty to spatial basis connections
sparsity_apply_to_temporal: false     # Apply sparsity penalty to temporal basis connections
sparsity_threshold_ratio: 0.01        # Threshold for "removed" basis = ratio × max_norm (1e-2 = 1% of max)

# Non-crossing penalty settings (for multi-quantile regression only)
# Prediction-level penalty (when use_delta_reparameterization=false):
# non_crossing_weight: 0.1            # Penalty weight (0.0 = off, 0.1-1.0 recommended to start)
# non_crossing_power: 1               # Penalty power: 1 (L1) or 2 (L2) - L1 often works better

# δ-level penalty (when use_delta_reparameterization=true):
# non_crossing_lambda: 1.0            # P_nc(δ) penalty weight λ (Section 3.2, Eq. 3.9)
                                      # Controls strength of non-crossing enforcement on δ parameters

hidden_dims: [256, 256, 128]          # MLP hidden layer dimensions
dropout: 0.1                          # Dropout rate
layernorm: true                       # Use LayerNorm
p_covariates: 0                       # Number of covariates

# Data settings
obs_method: site-wise             # Observation method: 'site-wise' or 'random'
obs_ratio: 0.1                    # Observation ratio
obs_spatial_pattern: corner       # Spatial observation pattern: 'uniform' or 'corner'
obs_spatial_intensity: 10.0        # Intensity of spatial pattern (for 'corner': higher = stronger near (0,0))
split_method: random              # Train/valid split method: 'site-wise' or 'random'
train_ratio: 0.8                  # Train/valid split ratio
normalize_target: false           # Normalize target values

# Training settings
epochs: 500
lr: 2e-2
basis_lr_ratio: 0.05              # Basis learning rate = lr × basis_lr_ratio (default: 5% of MLP lr)
weight_decay: 5e-4
batch_size: 4096
patience: 50
grad_clip: 10.0                   # Gradient clipping
scheduler: cosine
warmup_epochs: 10                 # Number of warmup epochs (increased for larger batch)

# Progressive unfreezing settings (for spatial_learnable=true)
basis_unfreeze_epoch: 10          # Epoch to unfreeze basis centers (0=train from start, >0=freeze then unfreeze)
basis_lr_rampup_epochs: 10        # Epochs to gradually ramp up basis lr after unfreezing (0=instant)

# Experiment settings
n_experiments: 50                 # Number of repeated experiments (M)
base_seed: 2025                   # Base seed (each experiment uses base_seed + i)
num_workers: 0                    # DataLoader workers per experiment (set to 0 when using parallel grid search)

# Regression type
regression_type: multi-quantile
quantile_levels: [0.05, 0.25, 0.5, 0.75, 0.95]

# δ reparameterization (Section 3.2)
# When enabled, uses cumulative construction β_k = Σ δ_ℓ for non-crossing quantiles
use_delta_reparameterization: false  # Set to true to enable δ reparameterization

# Device
device: cpu
