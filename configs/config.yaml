# STNF-XAttn 통합 설정 파일

# 데이터 경로
data:
  train_csv: "data/2a/2a_9_train.csv"
  test_csv: "data/2a/2a_9_test.csv"
  output_dir: "outputs"
  experiment_name: "2a9_full"  # 체크포인트: {output_dir}/{experiment_name}_ckpt.pt

# 데이터 로딩 설정
dataloader:
  L: 10                # context length
  H: 5                 # forecast horizon
  batch_size: 32
  num_workers: 0       # 윈도우에서 0 권장
  val_ratio_t: 0.1     # train 구간의 마지막 10%를 검증으로 사용

# 관측 샘플링
sampling:
  obs_fraction: 1.0   # 전체 사이트 중 100%만 관측으로 사용
  obs_sampling: uniform  # {uniform, biased}
  time_varying_obs: false
  bias_sigma: 0.15
  bias_temp: 1.0

# 데이터 정규화
preprocessing:
  normalize_target: false   # ✅ 정규화 필수!
  normalize_coords: false

# Covariates 설정
covariates:
  use_coords: false      # (x, y) 좌표를 covariates로 추가
  use_time: false        # ✅ 시간 정보 추가!
  time_encoding: linear # {linear, sinusoidal, learnable}
  # linear: t를 그대로 사용
  # sinusoidal: sin/cos으로 인코딩
  # learnable: embedding layer 사용

# 학습 설정
training:
  epochs: 50
  lr: 5.0e-4           # ✅ 학습률 낮춤 (0.01 → 0.001)
  weight_decay: 1.0e-4
  patience: 10          # Early stopping patience
  device: cuda         # {cuda, cpu}
  seed: 42
  grad_clip: 1.0       # ✅ gradient clipping 낮춤 (10 → 1)
  scheduler: cosine    # {null, cosine, step}
  scheduler_params:
    T_max: 30          # cosine scheduler용
    step_size: 10      # step scheduler용
    gamma: 0.5

# 모델 구조
model:
  d_site: 128          # SiteEncoder 출력 차원 (d)
  h_temporal: 128      # GRU hidden 차원 (h)
  dropout: 0.1         # ✅ Dropout 추가!
  layernorm: true      # ✅ LayerNorm 사용!
  n_heads: 5           # Cross-Attention head 수
  
  # Basis Embedding 설정
  use_basis_embedding: true    # Basis embedding 사용 여부
  basis_k: 250                 # Basis 함수 개수
  basis_initialize: regular    # Basis 초기화 방법 (regular)
  basis_learnable: false       # Basis 파라미터 학습 여부

# 로깅
logging:
  log_interval: 10     # 배치 단위 로깅 주기
  save_best_only: true # Best 모델만 저장
